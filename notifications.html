<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notifications - SocialTrade</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
</head>
<body class="bg-gray-50 min-h-screen">

    <div class="max-w-[500px] mx-auto bg-white min-h-screen shadow-lg">
        <div class="p-5 border-b sticky top-0 bg-white flex items-center justify-between z-10">
            <h1 class="text-xl font-black text-gray-800 uppercase italic">Notifications</h1>
            <button onclick="window.history.back()" class="text-gray-500"><i class="fas fa-arrow-left"></i></button>
        </div>

        <div id="notiList" class="divide-y divide-gray-100">
            <div class="p-10 text-center text-gray-400">Loading notifications...</div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyD1mn9MR9hyZ36Ce1lnGyJYmL6AHopScTA",
            authDomain: "social-media-5e6c8.firebaseapp.com",
            databaseURL: "https://social-media-5e6c8-default-rtdb.firebaseio.com/",
            projectId: "social-media-5e6c8",
            storageBucket: "social-media-5e6c8.firebasestorage.app",
            messagingSenderId: "897473713729",
            appId: "1:897473713729:web:7ba552ed4c1be8754418c0"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();

        auth.onAuthStateChanged(user => {
            if (user) loadNotifications(user.uid);
            else window.location.href = "login.html";
        });

        function loadNotifications(uid) {
            db.ref(`notifications/${uid}`).orderByChild('timestamp').on('value', snapshot => {
                const list = [];
                snapshot.forEach(child => {
                    list.unshift({ id: child.key, ...child.val() });
                });

                const container = document.getElementById('notiList');
                if (list.length === 0) {
                    container.innerHTML = `<div class="p-10 text-center text-gray-400">No notifications yet.</div>`;
                    return;
                }

                container.innerHTML = list.map(n => `
                    <div class="p-4 flex items-center gap-3 ${n.read ? 'bg-white' : 'bg-blue-50'} hover:bg-gray-50 transition cursor-pointer">
                        <img src="${n.senderPhoto || 'https://via.placeholder.com/50'}" class="h-12 w-12 rounded-full object-cover border">
                        <div class="flex-1">
                            <p class="text-sm text-gray-800">
                                <span class="font-bold">${n.senderName}</span> 
                                ${n.type === 'like' ? 'liked your post.' : 'commented on your post.'}
                            </p>
                            <p class="text-[11px] text-gray-500 mt-1">${new Date(n.timestamp).toLocaleString()}</p>
                        </div>
                        ${n.type === 'like' ? '<i class="fas fa-heart text-red-500"></i>' : '<i class="fas fa-comment text-blue-500"></i>'}
                    </div>
                `).join('');
            });
        }
    </script>
</body>
</html>
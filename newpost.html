<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Post - SocialTrade</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <style>
        /* ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡¶∂‡¶® ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá */
        body { 
            user-select: none; 
            -webkit-tap-highlight-color: transparent; 
            background-color: #f3f4f6;
        }
        
        #postContainer {
            width: 100%; height: 320px; border-radius: 1.5rem; transition: all 0.4s ease;
            background-color: #111827; display: flex; align-items: center;
            justify-content: center; padding: 20px; overflow: hidden; border: 1px solid #f3f4f6;
        }
        #postContent {
            background: transparent; border: none; resize: none; width: 100%; height: auto;
            max-height: 280px; outline: none; font-weight: 900; font-size: 1.6rem;
            color: white; text-align: center; line-height: 1.4; padding: 10px;
        }
        #postContent::placeholder { color: rgba(255,255,255,0.4); }
        .default-mode { background: #ffffff !important; align-items: flex-start !important; border: 1px solid #e5e7eb !important; overflow-y: auto !important; }
        .default-mode #postContent { color: #1f2937 !important; text-align: left !important; font-size: 1.1rem !important; font-weight: 500 !important; max-height: none !important; }
        .color-box { width: 38px; height: 38px; border-radius: 10px; cursor: pointer; border: 2px solid transparent; transition: 0.2s; flex-shrink: 0; }
        .color-active { border-color: #3b82f6; transform: scale(1.1); }
        .color-scroll::-webkit-scrollbar { height: 4px; }
        .color-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>

    <script>
        // üõ°Ô∏è Security: Disable Right Click
        document.addEventListener('contextmenu', e => e.preventDefault());

        // üõ°Ô∏è Security: Disable Inspect Shortcuts (F12, Ctrl+Shift+I, Ctrl+U etc.)
        document.onkeydown = function(e) {
            if (e.keyCode == 123 || 
                (e.ctrlKey && e.shiftKey && (e.keyCode == 'I'.charCodeAt(0) || e.keyCode == 'J'.charCodeAt(0) || e.keyCode == 'C'.charCodeAt(0))) || 
                (e.ctrlKey && e.keyCode == 'U'.charCodeAt(0))) {
                return false;
            }
        };
    </script>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div class="bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl overflow-hidden">
        <div class="p-5 border-b border-gray-100 flex items-center justify-between">
            <h2 class="text-xl font-black text-gray-800 uppercase tracking-tighter">Create <span class="text-blue-600">Post</span></h2>
            <button onclick="window.history.back()" class="text-gray-400 p-2"><i class="fas fa-times"></i></button>
        </div>

        <div class="p-6">
            <div id="userInfo" class="flex items-center space-x-3 mb-4">
                <img id="userAvatar" src="https://via.placeholder.com/150" class="h-10 w-10 rounded-full border object-cover shadow-sm">
                <div>
                    <p id="userName" class="text-sm font-black text-gray-800">Loading...</p>
                    <span class="text-[10px] bg-gray-100 text-gray-500 px-2 py-0.5 rounded-full font-bold uppercase">Public</span>
                </div>
            </div>

            <div id="postContainer">
                <textarea id="postContent" placeholder="What's on your mind?" oninput="handleInput()"></textarea>
            </div>

            <div id="colorSelector" class="mt-6">
                <p class="text-[10px] font-black text-gray-400 uppercase mb-3 tracking-widest">Select Background</p>
                <div class="flex gap-2 overflow-x-auto pb-3 color-scroll">
                    <div onclick="changeColor('none', this)" class="color-box bg-gray-900 flex items-center justify-center text-white color-active"><i class="fas fa-ban text-xs"></i></div>
                    <div onclick="changeColor('linear-gradient(45deg, #ff9a9e 0%, #fad0c4 100%)', this)" class="color-box" style="background: linear-gradient(45deg, #ff9a9e 0%, #fad0c4 100%);"></div>
                    <div onclick="changeColor('linear-gradient(135deg, #667eea 0%, #764ba2 100%)', this)" class="color-box" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"></div>
                    <div onclick="changeColor('linear-gradient(to right, #4facfe 0%, #00f2fe 100%)', this)" class="color-box" style="background: linear-gradient(to right, #4facfe 0%, #00f2fe 100%);"></div>
                    <div onclick="changeColor('linear-gradient(135deg, #f093fb 0%, #f5576c 100%)', this)" class="color-box" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);"></div>
                    <div onclick="changeColor('#FF5733', this)" class="color-box" style="background: #FF5733;"></div>
                </div>
            </div>

            <button id="postBtn" onclick="submitPost()" class="w-full mt-6 py-4 bg-blue-600 text-white font-black rounded-2xl shadow-lg hover:bg-blue-700 transition uppercase tracking-widest text-sm active:scale-95">Post Now</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyD1mn9MR9hyZ36Ce1lnGyJYmL6AHopScTA",
            authDomain: "social-media-5e6c8.firebaseapp.com",
            databaseURL: "https://social-media-5e6c8-default-rtdb.firebaseio.com/",
            projectId: "social-media-5e6c8",
            storageBucket: "social-media-5e6c8.firebasestorage.app",
            messagingSenderId: "897473713729",
            appId: "1:897473713729:web:7ba552ed4c1be8754418c0"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();

        let selectedBg = "none";
        let userProfileData = null;

        auth.onAuthStateChanged(async user => {
            if (user) {
                const snap = await db.ref(`user-info/${user.uid}/profile`).once('value');
                userProfileData = snap.val();
                
                if (userProfileData) {
                    document.getElementById('userName').innerText = userProfileData.fullName || "User";
                    document.getElementById('userAvatar').src = userProfileData.profilePic || `https://ui-avatars.com/api/?name=${userProfileData.fullName}`;
                }
            } else {
                window.location.href = "login.html";
            }
        });

        function handleInput() {
            const container = document.getElementById('postContainer');
            const textArea = document.getElementById('postContent');
            const selector = document.getElementById('colorSelector');
            
            textArea.style.height = 'auto';
            textArea.style.height = textArea.scrollHeight + 'px';

            if (textArea.scrollHeight > 280 || textArea.value.length > 150) {
                container.classList.add('default-mode');
                selector.style.display = "none";
            } else {
                container.classList.remove('default-mode');
                selector.style.display = "block";
                updateBackground();
            }
        }

        function changeColor(color, el) {
            selectedBg = color;
            document.querySelectorAll('.color-box').forEach(b => b.classList.remove('color-active'));
            el.classList.add('color-active');
            updateBackground();
        }

        function updateBackground() {
            const container = document.getElementById('postContainer');
            const textArea = document.getElementById('postContent');
            container.style.background = selectedBg === 'none' ? "#111827" : selectedBg;
            textArea.style.color = "white";
        }

        async function submitPost() {
            const content = document.getElementById('postContent').value.trim();
            if (!content) return Swal.fire("Empty", "Write something!", "warning");
            if (!userProfileData) return Swal.fire("Error", "User data not loaded!", "error");

            const btn = document.getElementById('postBtn');
            btn.disabled = true;
            btn.innerText = "Posting...";

            const isDefault = document.getElementById('postContainer').classList.contains('default-mode');

            const postData = {
                uid: auth.currentUser.uid,
                userName: userProfileData.fullName,
                userPhoto: userProfileData.profilePic || "",
                text: content,
                background: isDefault ? "none" : (selectedBg === 'none' ? "#111827" : selectedBg),
                timestamp: firebase.database.ServerValue.TIMESTAMP
            };

            try {
                await db.ref('posts').push(postData);
                Swal.fire("Success!", "Post Published", "success").then(() => {
                    window.location.href = "newpost.html";
                });
            } catch (err) {
                Swal.fire("Error", err.message, "error");
                btn.disabled = false;
                btn.innerText = "Post Now";
            }
        }
    </script>
</body>
</html>

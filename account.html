<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>User Panel - SocialTrade</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <style>
        body { user-select: none; -webkit-tap-highlight-color: transparent; }
        .sidebar-scroll::-webkit-scrollbar { width: 4px; }
        .sidebar-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .content-frame { height: calc(100vh - 64px); width: 100%; border: none; }

        @media (max-width: 1023px) {
            #sidebar.closed { transform: translateX(-100%); }
            #sidebar.open { transform: translateX(0); }
        }

        @media (min-width: 1024px) {
            #sidebar { transform: translateX(0) !important; position: fixed !important; }
            .main-content { margin-left: 256px; } 
            #mobile-toggle { display: none; }
            #overlay { display: none !important; }
        }
    </style>

    <script>
        // ðŸ›¡ï¸ Advanced Anti-Inspect Security
        document.addEventListener('contextmenu', e => e.preventDefault());
        document.onkeydown = function(e) {
            if (e.keyCode == 123 || (e.ctrlKey && e.shiftKey && (e.keyCode == 73 || e.keyCode == 67 || e.keyCode == 74)) || (e.ctrlKey && e.keyCode == 85)) return false;
        };
        // Disable DevTools auto-open
        setInterval(function(){ debugger; }, 100);
    </script>
</head>
<body class="bg-gray-100 overflow-hidden">

    <nav class="bg-white border-b border-gray-200 h-16 flex items-center justify-between px-4 fixed top-0 w-full z-50">
        <div class="flex items-center">
            <button id="mobile-toggle" class="p-2 mr-3 text-gray-600 focus:outline-none hover:bg-gray-100 rounded-lg">
                <i class="fas fa-bars text-xl"></i>
            </button>
            <span class="text-xl font-black text-blue-600 tracking-tighter">
                SOCIALTRADE <span class="text-gray-400 text-[10px] ml-1 uppercase">User</span>
            </span>
        </div>
        
        <div class="flex items-center space-x-3">
            <div class="hidden sm:block text-right">
                <p id="userNameDisplay" class="text-[12px] font-bold text-gray-800 leading-none">Loading...</p>
                <p class="text-[9px] text-blue-500 font-bold uppercase">Trader Account</p>
            </div>
            <img id="userAvatar" src="https://ui-avatars.com/api/?name=User&background=0D8ABC&color=fff" 
                 class="h-9 w-9 rounded-full border-2 border-blue-100 object-cover shadow-sm">
        </div>
    </nav>

    <div class="flex pt-16 h-screen">
        <aside id="sidebar" class="bg-white border-r border-gray-200 w-64 fixed inset-y-0 left-0 top-16 z-40 sidebar-scroll overflow-y-auto closed shadow-2xl lg:shadow-none transition-transform duration-300">
            <div class="p-4 space-y-6">
                
                <div>
                    <h4 class="text-[10px] font-black text-gray-400 uppercase tracking-widest px-4 mb-2">Main Dashboard</h4>
                    <ul class="space-y-1">
                        <li>
                            <a href="allpost.html" target="contentFrame" class="nav-link flex items-center px-4 py-3 text-sm font-bold text-blue-600 bg-blue-50 rounded-xl">
                                <i class="fas fa-th-large mr-3 w-5"></i> Home Page
                            </a>
                        </li>
                        <li>
                            <a href="marketplace.html" target="contentFrame" class="nav-link flex items-center px-4 py-3 text-sm font-bold text-gray-600 hover:bg-gray-50 rounded-xl">
                                <i class="fas fa-shopping-basket mr-3 w-5"></i> Marketplace
                            </a>
                        </li>
                    </ul>
                </div>

                <div>
                    <h4 class="text-[10px] font-black text-gray-400 uppercase tracking-widest px-4 mb-2">Trading & Ads</h4>
                    <ul class="space-y-1">
                        <li><a href="newpost.html" target="contentFrame" class="nav-link flex items-center px-4 py-3 text-sm font-bold text-gray-600 hover:bg-gray-50 rounded-xl"><i class="fas fa-plus-circle mr-3 w-5 text-blue-500"></i> Post New Add</a></li>
                        <li><a href="my_ads.html" target="contentFrame" class="nav-link flex items-center px-4 py-3 text-sm font-bold text-gray-600 hover:bg-gray-50 rounded-xl"><i class="fas fa-list-check mr-3 w-5 text-purple-500"></i> My Active Ads</a></li>
                    </ul>
                </div>

                <div>
                    <h4 class="text-[10px] font-black text-gray-400 uppercase tracking-widest px-4 mb-2">Finance</h4>
                    <ul class="space-y-1">
                        <li><a href="overview.html" target="contentFrame" class="nav-link flex items-center px-4 py-3 text-sm font-bold text-gray-600 hover:bg-gray-50 rounded-xl"><i class="fas fa-wallet mr-3 w-5 text-orange-500"></i> My Wallet</a></li>
                        <li><a href="deposit_money.html" target="contentFrame" class="nav-link flex items-center px-4 py-3 text-sm font-bold text-gray-600 hover:bg-gray-50 rounded-xl"><i class="fas fa-arrow-down mr-3 w-5 text-green-500"></i> Deposit</a></li>
                        <li><a href="withdraw_money.html" target="contentFrame" class="nav-link flex items-center px-4 py-3 text-sm font-bold text-gray-600 hover:bg-gray-50 rounded-xl"><i class="fas fa-arrow-up mr-3 w-5 text-red-500"></i> Withdraw</a></li>
                    </ul>
                </div>

                <div>
                    <h4 class="text-[10px] font-black text-gray-400 uppercase tracking-widest px-4 mb-2">Personal</h4>
                    <ul class="space-y-1">
                        <li><a href="profile_settings.html" target="contentFrame" class="nav-link flex items-center px-4 py-3 text-sm font-bold text-gray-600 hover:bg-gray-50 rounded-xl"><i class="fas fa-user-gear mr-3 w-5 text-gray-500"></i> Settings</a></li>
                    </ul>
                </div>

                <div class="pt-4 border-t border-gray-100">
                    <button onclick="logout()" class="w-full flex items-center px-4 py-3 text-sm font-black text-red-500 hover:bg-red-50 rounded-xl transition">
                        <i class="fas fa-sign-out-alt mr-3 w-5"></i> Logout
                    </button>
                </div>
            </div>
        </aside>

        <main class="main-content flex-1 relative overflow-hidden transition-all duration-300">
            <div id="overlay" class="hidden fixed inset-0 bg-black/40 backdrop-blur-sm z-30 lg:hidden"></div>
            <iframe name="contentFrame" id="contentFrame" src="allpost.html" class="content-frame"></iframe>
        </main>
    </div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyD1mn9MR9hyZ36Ce1lnGyJYmL6AHopScTA",
        authDomain: "social-media-5e6c8.firebaseapp.com",
        databaseURL: "https://social-media-5e6c8-default-rtdb.firebaseio.com/",
        projectId: "social-media-5e6c8",
        storageBucket: "social-media-5e6c8.firebasestorage.app",
        messagingSenderId: "897473713729",
        appId: "1:897473713729:web:7ba552ed4c1be8754418c0"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();
    let myUid = "";

    // ðŸŸ¢ à§© à¦®à¦¿à¦¨à¦¿à¦Ÿ à¦…à¦¨à¦²à¦¾à¦‡à¦¨ à¦¥à¦¾à¦•à¦¾à¦° à¦²à¦œà¦¿à¦• (à¦°à¦¿à¦²à§‹à¦¡ à¦›à¦¾à§œà¦¾ à¦•à¦¾à¦œ à¦•à¦°à¦¬à§‡)
    function syncStatus() {
        if(!myUid) return;
        db.ref(`status/${myUid}`).set({ 
            state: 'online', 
            last: Date.now() + 180000 
        });
    }

    auth.onAuthStateChanged((user) => {
        if (user) {
            myUid = user.uid;
            syncStatus();
            setInterval(syncStatus, 60000); // à¦ªà§à¦°à¦¤à¦¿ à§§ à¦®à¦¿à¦¨à¦¿à¦Ÿà§‡ à¦†à¦ªà¦¡à§‡à¦Ÿ à¦¹à¦¬à§‡

            // ðŸš« à¦°à¦¿à§Ÿà§‡à¦²-à¦Ÿà¦¾à¦‡à¦® à¦¬à§à¦²à¦• à¦šà§‡à¦•
            db.ref('user-info/' + user.uid).on('value', (snapshot) => {
                const userData = snapshot.val();
                if (userData) {
                    if (userData.profile?.status === 'blocked' || userData.isBlocked === true) {
                        window.location.href = "error.html";
                        return;
                    }
                    
                    if (userData.profile) {
                        document.getElementById('userNameDisplay').innerText = userData.profile.fullName || "User";
                        const avatarUrl = userData.profile.profilePic || `https://ui-avatars.com/api/?name=${userData.profile.fullName}&background=random&color=fff`;
                        document.getElementById('userAvatar').src = avatarUrl;
                    }
                }
            });
        } else {
            window.location.href = "login.html";
        }
    });

    // à¦¸à¦¾à¦‡à¦¡à¦¬à¦¾à¦° à¦•à¦¨à§à¦Ÿà§à¦°à§‹à¦²
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');
    const mobileToggle = document.getElementById('mobile-toggle');

    function toggleSidebar() {
        sidebar.classList.toggle('closed');
        sidebar.classList.toggle('open');
        overlay.classList.toggle('hidden');
    }

    document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', (e) => {
            // à¦²à¦¿à¦™à§à¦•à§‡ à¦•à§à¦²à¦¿à¦• à¦•à¦°à¦²à§‡ à¦¨à§€à¦² à¦°à¦™ à¦ªà¦°à¦¿à¦¬à¦°à§à¦¤à¦¨ à¦¹à¦¬à§‡ (Active State)
            document.querySelectorAll('.nav-link').forEach(l => {
                l.classList.remove('text-blue-600', 'bg-blue-50');
                l.classList.add('text-gray-600');
            });
            link.classList.add('text-blue-600', 'bg-blue-50');
            link.classList.remove('text-gray-600');

            if (window.innerWidth < 1024) toggleSidebar();
        });
    });

    mobileToggle.addEventListener('click', toggleSidebar);
    overlay.addEventListener('click', toggleSidebar);

    function logout() {
        auth.signOut().then(() => {
            window.location.href = "login.html";
        });
    }

    window.onload = () => {
        if (window.innerWidth < 1024) sidebar.classList.add('closed');
    };
</script>
</body>
</html>
